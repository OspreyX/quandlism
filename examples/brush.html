<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <title>brush</title>
  <style type="text/css" media="screen">
  svg {
    font: 10px sans-serif;
  }

  path {
    fill: steelblue;
  }

  .axis path,
  .axis line {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
  }

  .brush .extent {
    stroke: #fff;
    fill-opacity: .125;
    shape-rendering: crispEdges;
  }
    
  </style>
</head>
<body id="brush" onload="">
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.8.2/jquery.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.1/underscore-min.js" type="text/javascript" charset="utf-8"></script>
  <script src="../lib/d3.v2.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript" charset="utf-8">
  var margin = { 
    top: 10,
    right: 10,
    bottom: 100,
    left: 40
  };
  var margin2 = {
    top: 430, 
    right: 10,
    bottom: 20,
    left: 40
  };
  
  var w = 960 - margin.left - margin.right;
  var h1 = 500 - margin.top - margin.bottom;
  var h2 = 500 - margin2.top - margin2.bottom;
  
  var parseDate = d3.time.format('%Y-%m-%d').parse;
  
  var x = d3.time.scale().range([0, w])
  var x2 = d3.time.scale().range([0, w]);
  var y = d3.scale.linear().range([h1, 0]);
  var y2 = d3.scale.linear().range([h2, 0]);
  
  var xAxis = d3.svg.axis().scale(x).orient('bottom');
  var xAxis2 = d3.svg.axis().scale(x2).orient('bottom');
  var yAxis = d3.svg.axis().scale(y).orient('left');
  
  var brush = d3.svg.brush().x(x2).on('brush', brush);
  
  var area = d3.svg.area()
    .interpolate('monotone')
    .x(function(d) { 
      return x(d.Date); 
    })
    .y0(h1)
    .y1(function(d) { 
      return y2(d.Value)
    });
  
  var area2 = d3.svg.area()
    .interpolate('monotone')
    .x(function(d) {
      return x2(d.Date);
    })
    .y0(h2)
    .y1(function(d) {
      return y2(d.Value);
    });
    
  var svg = d3.select('body').append('svg')
    .attr('width', w + margin.left + margin.right)
    .attr('height', h1 + margin.top + margin.bottom);
    
  svg.append('defs').append('clipPath')
    .attr('id', 'clip')
    .append('rect')
    .attr('width', w)
    .attr('height', h1);
    
  var focus = svg.append('g').attr('transform', 'translate(' + margin.left + ', ' + margin.top + ')');
  var context = svg.append('g').attr('transform', 'translate(' + margin2.left + ', ' + margin2.top + ')');
  
  
  d3.csv('/data/boj.csv', function(data, error) {
    data.forEach(function(d) {
      d.Date = parseDate(d.Date);
      d.Value = d.Value;
    });
    
    x.domain(d3.extent(data.map(function(d) { return d.Date})));
    y.domain([0, d3.max(data.map(function(d) { return d.Value;}))]);
    x2.domain(x.domain());
    y2.domain(y.domain());
    
    focus.append("path")
        .datum(data)
        .attr("clip-path", "url(#clip)")
        .attr("d", area);

    focus.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + h1 + ")")
        .call(xAxis);

    focus.append("g")
        .attr("class", "y axis")
        .call(yAxis);

    context.append("path")
        .datum(data)
        .attr("d", area2);

    context.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + h2 + ")")
        .call(xAxis2);

    context.append("g")
        .attr("class", "x brush")
        .call(brush)
      .selectAll("rect")
        .attr("y", -6)
        .attr("height", h2 + 7);
    
  });
  
  function brush() {
    x.domain(brush.empty() ? x2.domain() : brush.extent());
    focus.select('path').attr('d', area);
    focus.select('.x.axis').call(xAxis);
  }
  
  
  </script>
</body>
</html>
