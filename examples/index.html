<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <title>Quandlism Test</title>

</head>
<body id="index" onload="">
  
  <div id='chart'></div>

  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.8.2/jquery.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.1/underscore-min.js" type="text/javascript" charset="utf-8"></script>
  <script src="../lib/d3.v2.js" type="text/javascript" charset="utf-8"></script>
  <script src="../quandlism.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript" charset="utf-8">
  
  var color = d3.scale.category10();

  var context = quandlism.context().width(1500).frequency('daily').trans('none');
  
  d3.csv('/data/apple.csv', function(data) {
    
    dateColumn = context.utility().dateColumn(data[0]);

    color.domain(d3.keys(data[0]).filter(function(key) { return key != dateColumn }));
    // Parse the data  
    
    
    data.forEach(function(d) {
      d[dateColumn] = context.utility().parseDate(d[dateColumn]);
    });
            
    var metrics = color.domain().map(function(name) {
      return {
        name: name,
        values: data.map(function(d) {
          return {date: d[dateColumn], num: +d[name]};
        })
      }
    });
    
        
    var columns = _.map(metrics, function(m, i) {
      return context.line(m);
    });      
         
    
    d3.select('#chart').datum(columns).call(context.stage());

  });
    
 
    </script>
</body>
</html>