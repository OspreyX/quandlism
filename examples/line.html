<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <title>line</title>
  <style type="text/css" media="screen">
  body {
    font: 10px sans-serif;
  }

  .mini  {
    background: #CFCFCF;
  }
  .axis path,
  .axis line {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
  }

  .x.axis path {
    display: none;
  }

  .line {
    fill: none;
    stroke: steelblue;
    stroke-width: 1.5px;
  }
  </style>
</head>
<body id="line" onload="">
  
  <script src="../lib/d3.v2.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript" charset="utf-8">
  var margin      = {top: 20, right: 80, bottom: 30, left: 50},
      width       = 960 - margin.left - margin.right,
      height      = 600 - margin.top - margin.bottom,
      miniHeight  = 150,
      mainHeight  = height - miniHeight - 50; 
      
  var parseDate = d3.time.format("%Y-%m-%d").parse;
  
  var x = d3.time.scale().range([0, width]);
  var y = d3.time.scale().range([mainHeight, 0]);
  
  var color = d3.scale.category10();
  
  var xAxis = d3.svg.axis().scale(x).orient('bottom');
  
  var yAxis = d3.svg.axis().scale(y).orient('left');
  
  var line = d3.svg.line().interpolate('basis')
    .x(function(d) { return x(d.date) })
    .y(function(d) { return y(d.num) });
    
  var svg = d3.select('body').append('svg')
    .attr('width', width + margin.left + margin.right)
    .attr('height', height + margin.top + margin.bottom)
    .attr('transform', 'translate(' + margin.left + ', ' + margin.top + ')');
  
  var main = svg.append('g')
    .attr('width', width)
    .attr('height', mainHeight)
    .attr('class', 'main')
    .attr('transform', 'translate(' + margin.left + ', ' + margin.top + ')');
    
  var mini = svg.append('g')
    .attr('width', width)
    .attr('height', miniHeight)
    .attr('class', 'mini')
    .attr('transform', 'translate(' + margin.left + ', ' + (mainHeight + 60) +  ')');
    
  d3.csv('/data/boj.csv', function(data) {
    color.domain(d3.keys(data[0]).filter(function(key) { return key != 'Date' }));
    
    data.forEach(function(d) {
      d.Date = parseDate(d.Date);
    });
    
    var metrics = color.domain().map(function(name) {
      return {
        name: name,
        values: data.map(function(d) {
          return {date: d.Date, num: +d[name]};
        })
      }
    });
    
    x.domain(d3.extent(data, function(d) { return d.Date }));
    y.domain([
      d3.min(metrics, function(c) { 
        return d3.min(c.values, function(v) { 
          return v.num 
        })
      }),
      d3.max(metrics, function(c) { 
        return d3.max(c.values, function(v) { 
          return v.num 
        })
      })
    ]);
    
    svg.append('g')
      .attr('class', 'x axis')
      .attr('transform', 'translate(0, ' + mainHeight + ')')
      .call(xAxis);
      
    svg.append('g')
      .attr('class', 'y axis')
      .attr('transform', 'translate(0, ' + mainHeight + ')')
      .call(yAxis);
      
    var metric = main.selectAll('.city')
      .data(metrics)
      .enter()
      .append('g')
      .attr('class', 'city');
      
    metric.append('path')
      .attr('class', 'line')
      .attr('d', function(d) { return line(d.values); })
      .style('stroke', function(d) { return color(d.name); });
      
  
    
    
  });
  </script>
</body>
</html>