(function(e){(function(){var t,n,r,i,s,o,u,a,f,l,c,h=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};i=e.quandlism={version:"0.7.4"},i.context=function(){var e,n,r,i,s,o,a,f,l,c,p,d,v,m,g,y,b,w=this;return r=new t,g=null,c=null,i=null,a=null,s=null,o=null,f=null,b=null,y=null,d=0,m=.7,l=d3.dispatch("respond","adjust","toggle","refresh"),n=["#e88033","#4eb15d","#c45199","#6698cb","#6c904c","#e9563b","#9b506f","#d2c761","#4166b0","#44b1ae"],p=[],v=["BUILD","MERGE"],e={},r.addCallback=function(t,n){if(t==null||!_.isFunction(n))return;e[""+t]==null&&(e[""+t]=[]),e[""+t].push(n)},r.runCallbacks=function(t){var n,r,i,s;if(e[""+t]==null||!e[""+t].length)return;s=e[""+t];for(r=0,i=s.length;r<i;r++)n=s[r],n()},r.attachData=function(e,t){var n;t==null&&(t="build");if(t!=null&&(n=t.toUpperCase(),h.call(v,n)>=0))return r.extractArguments(e),p=r.utility()[""+t.toLowerCase()+"Lines"](e,p!=null?p:null),p=r.utility().processLines(e,p),r.bindToElements(),r;throw"Unknown process "+t},r.bindToElements=function(){return a&&d3.select(a).datum(p),s&&d3.select(s).datum(p),o&&d3.select(o).datum(p),r},r.extractArguments=function(e){var t,n;for(t in e){n=e[t];switch(t){case"y_axis_min":r.yAxisMin(n);break;case"y_axis_max":r.yAxisMax(n)}}},r.resetArguments=function(){return b=null,y=null,r},r.render=function(){return r.build(),a&&d3.select(a).call(r.stage()),s&&d3.select(s).call(r.brush()),o&&d3.select(o).call(r.legend()),r.respond(),r},r.update=function(){return r.build(),r.respond(),r.refresh(),r},r.build=function(){return g=$(i).width(),c=$(i).height(),r},r.chart=function(e,t){var n,o,f;if(!e.length)throw"Invalid container";return n=t!=null?t:!0,e.children().remove(),e.attr("id")==null&&e.attr("id","quandlism-"+ ++u),i="#"+e.attr("id"),f="quandlism-stage-"+ ++u,e.append("<div class='stage' id='"+f+"'></div>"),a="#"+f,n&&(o="quandlism-brush-"+ ++u,e.append("<div class='brush' id='"+o+"'></div>"),s="#"+o),r},r.withLegend=function(e){if(!e.length)throw"Invalid container";return e.attr("id")||e.attr("id","quandlism-legend-"+ ++u),o="#"+e.attr("id"),r},r.addColorsIfNecessary=function(e){var t,r,i,s;r=e.length-n.length;if(r<0)return;t=.1,i=0;while(i<r)s=d3.rgb(n[i]).brighter(t),n.push(s.toString()),i++},r.resetState=function(){b=y=null},r.lines=function(e){return e?(p=e,r):p},r.colorList=function(e){return e==null?n:(n=e,r)},r.startPoint=function(e){return e==null?m:(m=e,r)},r.w=function(e){return e==null?g:(g=e,r)},r.h=function(e){return e==null?c:(c=e,r)},r.yAxisMin=function(e){return e==null?b:(b=e,r)},r.yAxisMax=function(e){return e==null?y:(y=e,r)},r.dom=function(e){return e==null?i:(i=e,r)},r.domstage=function(e){return e==null?a:(a=e,r)},r.dombrush=function(e){return e==null?s:(s=e,r)},r.domlegend=function(e){return e==null?o:(o=e,r)},r.padding=function(e){return e==null?d:(d=e,r)},r.callbacks=function(t){return t==null?e:(e=t,r)},r.respond=_.throttle(function(){return l.respond.call(r,500)}),r.adjust=function(e,t,n,i){return l.adjust.call(r,e,t,n,i),r.runCallbacks("adjust")},r.toggle=function(){return l.toggle.call(r)},r.refresh=function(){l.refresh.call(r)},r.on=function(e,t){return t==null?l.on(e):(l.on(e,t),r)},d3.select(window).on("resize",function(){var e,t;d3.event.preventDefault();if(i){t=$(i).width(),e=$(i).height();if(g!==t||c!==e)g=t,c=e,r.respond()}}),r},t=function(){function e(){}return e}(),n=t.prototype=i.context.prototype,s=0,a=0,u=0,c=40,l={h:.1},o={h:.15},f={h:.65},r=function(){function e(){}return e}(),n.line=function(e){var t,n,i,s,o,u,f,l,c,h=this;return u=new r,n=this,f=e.name,l=e.values.reverse(),i=[],s=[],o=a++,c=!1,t="#000000",u.setup=function(){var e;i=function(){var t,n,r;r=[];for(t=0,n=l.length;t<n;t++)e=l[t],r.push(e.date);return r}(),s=_.map(i,function(e){return n.utility().getDateKey(e)}),window.dates=i,s=s},u.setup(),u.extent=function(e,t){var n,r,i,s,o;n=e!=null?e:0,s=t!=null?t:this.length()-1,i=Infinity,r=-Infinity;if(!this.visible())return[i,r];while(n<=s){o=this.valueAt(n);if(o==null){n++;continue}o<i&&(i=o),o>r&&(r=o),n++}return[i,r]},u.extentByDate=function(e,t){var n,r,i,s,o,u,a,f;s=Infinity,i=-Infinity;if(!this.visible())return[s,i];f=this.dates();for(r=u=0,a=f.length;u<a;r=++u){n=f[r];if(!(n<=t&&n>=e))continue;o=this.valueAt(r);if(o==null)continue;o<s&&(s=o),o>i&&(i=o)}return[s,i]},u.length=function(){return l.length},u.valueAt=function(e){return l[e]!=null?l[e].num:null},u.dateAt=function(e){return i[e]!=null?i[e]:null},u.drawPointAtIndex=function(e,t,n,r,i){if(!this.visible())return;return e.beginPath(),e.arc(t(this.dateAt(r)),n(this.valueAt(r)),i,0,Math.PI*2,!0),e.fillStyle=this.color(),e.fill(),e.closePath()},u.drawPath=function(e,t,n,r){var i,s,o,u,a;if(!this.visible())return;e.beginPath(),a=this.dates();for(s=o=0,u=a.length;o<u;s=++o){i=a[s];if(this.valueAt(s)==null)continue;e.lineTo(t(i),n(this.valueAt(s)))}e.lineWidth=r,e.strokeStyle=this.color(),e.stroke(),e.closePath()},u.drawPathFromIndicies=function(e,t,n,r,i,s){var o,u;if(!this.visible())return;e.beginPath();for(o=u=r;r<=i?u<=i:u>=i;o=r<=i?++u:--u){if(this.valueAt(o)==null)continue;e.lineTo(t(this.dateAt(o)),n(this.valueAt(o)))}return e.lineWidth=s,e.strokeStyle=this.color(),e.stroke(),e.closePath()},u.getClosestDataPoint=function(e){var t;return t=this.getClosestIndex(e),l[t]},u.getClosestIndex=function(e){var t,r,i,o,u,a,f,l,c,h,p;r=Infinity,t=0,c=Infinity,u=n.utility().getDateKey(e);for(f=h=0,p=s.length;h<p;f=++h){o=s[f],l=n.utility().getDateKey(o),a=Math.abs(l-u);if(a<r)c=r,r=a,i=f;else if(c<a)break}return i},u.drawPoints=function(e,t,n,r,i,s){var o,u,a,f,l,c;if(!this.visible())return;l=this.dates(),c=[];for(u=a=0,f=l.length;a<f;u=++a){o=l[u];if(!(o>=r&&o<=i))continue;e.beginPath(),e.arc(t(o),n(this.valueAt(u)),3,0,Math.PI*2,!0),e.fillStyle=this.color(),e.fill(),c.push(e.closePath())}return c},u.toggle=function(){var e;return e=!this.visible(),this.visible(e),e},u.dates=function(e){return e==null?i:(i=e,u)},u.id=function(e){return e==null?o:(o=e,u)},u.name=function(e){return e==null?f:(f=e,u)},u.values=function(e){return e==null?l:(l=e,u)},u.visible=function(e){return e==null?c:(c=e,u)},u.color=function(e){return e==null?t:(t=e,u)},u},n.timeScale=function(){var e,t;return e=this,t=d3.time.scale()},n.stage=function(){var e,t,n,r,i,s,o,a,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C=this;return r=this,t=null,n=null,y=[],g=null,E=Math.floor(r.w()-c-2),d=Math.floor(r.h()*f.h),x=d3.time.scale(),N=d3.scale.linear(),S=d3.svg.axis().orient("bottom").scale(x),T=d3.svg.axis().orient("left").scale(N),p=[],w=10,o=null,s=null,h=null,a=null,m=null,v=null,w=10,e=null,i=null,b=function(a){var h,b,C,k,L,A,O,M,D,P;t==null&&(t="canvas-stage-"+ ++u),y=a.datum(),g=_.first(y),a.attr("style","position: absolute; left: 0px; top: 0px;"),P=a.insert("svg"),P.attr("class","y axis"),P.attr("id","y-axis-"+t),P.attr("width",c),P.attr("height",Math.floor(r.h()*f.h)),P.attr("style","position: absolute; left: 0px; top: 0px;"),e=a.append("canvas"),e.attr("width",E),e.attr("height",d),e.attr("class","canvas-stage"),e.attr("id",t),e.attr("style","position: absolute; left: "+c+"px; top: 0px;"),e.attr("data-y_min",null),e.attr("data-y_max",null),i=e.node().getContext("2d"),D=a.append("svg"),D.attr("class","x axis"),D.attr("id","x-axis-"+t),D.attr("width",Math.floor(r.w()-c)),D.attr("height",Math.floor(r.h()*l.h)),D.attr("style","position: absolute; left: "+c+"px; top: "+r.h()*f.h+"px"),M=function(e){var r,i;if(e==null)return;n==null&&(n=document.getElementById(""+t));for(r in e)i=e[r],n.setAttribute("data-"+r,i)},O=function(){var e,t,n;if(r.yAxisMax()==null||r.yAxisMin()==null)p=r.utility().getExtent(y,m,v),p[0]===p[1]&&(p=r.utility().getExtent(y,0,g.length()));n=t=null,r.yAxisMin()!=null&&!_.isEmpty(r.yAxisMin())&&(n=r.yAxisMin()),r.yAxisMin()!=null&&!_.isEmpty(r.yAxisMax())&&(t=r.yAxisMax()),console.log("A: "+n+" "+t),n=n!=null?n:p[0],t=t!=null?t:p[1],console.log("B: "+n+" "+t),r.yAxisMin(n),r.yAxisMax(t),N.domain([n,t]),N.range([d-r.padding(),r.padding()]),T.ticks(Math.floor(r.h()*f.h/30)),T.tickSize(5,3,0),e=r.utility().getUnitAndDivisor(Math.round(p[1])),T.tickFormat(function(t){var n;return n=(t/e.divisor).toFixed(2),n=n.replace(/0+$/,""),n=n.replace(/\.$/,""),""+n+" "+e.label}),x.domain([o,s]),x.range([r.padding(),E-r.padding()])},C=function(){var e,t;P.selectAll("*").remove(),t=P.append("g"),t.attr("transform","translate("+(c-1)+", 0)"),t.call(T),D.selectAll("*").remove(),e=D.append("g"),e.call(S)},k=function(){var e,t,n,s,o,u,a,l,h;a=N.ticks(Math.floor(r.h()*f.h/30));for(n=0,o=a.length;n<o;n++)t=a[n],i.beginPath(),i.strokeStyle="#EDEDED",i.lineWidth=1,i.moveTo(0,Math.floor(N(t))),i.lineTo(E,Math.floor(N(t))),i.stroke(),i.closePath();l=x.ticks(Math.floor((r.w()-c)/100)),h=[];for(s=0,u=l.length;s<u;s++)e=l[s],i.beginPath(),i.strokeStyle="#EDEDED",i.lineWith=1,i.moveTo(x(e),d),i.lineTo(x(e),0),i.stroke(),h.push(i.closePath());return h},b=function(e){var t,n,r,s,o,u;e=e!=null?e:-1,C(),i.clearRect(0,0,E,d),k();for(n=s=0,u=y.length;s<u;n=++s){g=y[n],r=n===e?3:1.5,g.drawPathFromIndicies(i,x,N,m,v,r);if(v-m<w)for(t=o=m;m<=v?o<=v:o>=v;t=m<=v?++o:--o)g.drawPointAtIndex(i,x,N,t,2)}},A=function(e){var t,n,s,o,u,a,f,l,c,h,p,d,v,m;t=r.utility().getPixelRGB(e,i),s=_.indexOf(r.colorList(),t);if(s!==-1)return{x:e[0],color:t,line:y[s]};n=[];for(o=f=h=e[0]-3,p=e[0]+3;h<=p?f<=p:f>=p;o=h<=p?++f:--f)for(u=l=d=e[1]-3,v=e[1]+3;d<=v?l<=v:l>=v;u=d<=v?++l:--l)(o!==e[0]||u!==e[1])&&n.push([o,u]);for(a=c=0,m=n.length-1;0<=m?c<=m:c>=m;a=0<=m?++c:--c){t=r.utility().getPixelRGB(n[a],i),s=_.indexOf(r.colorList(),t);if(s!==-1)return{x:n[a][0],color:t,line:y[s]}}return!1},L=function(e,t,n){var s,o,u,a,f,l;u=t.line,s=u.dateAt(n),f=u.valueAt(n),b(u.id()),u.drawPointAtIndex(i,x,N,n,3),o=e[1]<=20&&e[0]>=E-250,l=o?E-400:E,i.beginPath(),i.fillStyle="rgba(237, 237, 237, 0.80)",i.fillRect(l-240,0,240,15),i.closePath(),i.fillStyle="#000",i.textAlign="start",a=""+r.utility().getMonthName(s.getUTCMonth())+"  "+s.getUTCDate()+", "+s.getFullYear()+": ",a+=""+r.utility().formatNumberAsString(f.toFixed(2)),i.fillText(a,l-110,10,100),i.fillStyle=u.color(),i.textAlign="end",i.fillText(""+r.utility().truncate(u.name(),20),l-120,10,200)},h=function(){b()},r.dombrush()==null&&(o=_.first(y[0].dates()),s=_.last(y[0].dates()),m=0,v=g.length(),O(),b()),r.on("respond.stage",function(){i.clearRect(0,0,E,d),E=Math.floor(r.w()-c-1),d=Math.floor(r.h()*f.h),e.attr("width",E),e.attr("height",d),P.attr("width",c),D.attr("width",Math.floor(r.w()-c)),O(),b()}),r.on("adjust.stage",function(e,t,n,r){m=t,v=r,o=e,s=n,O(),b()}),r.on("toggle.stage",function(){O(),b()}),r.on("refresh.stage",function(){y=a.datum(),g=_.first(y),r.dombrush()||b()}),d3.select("#"+t).on("mousemove",function(e){var t,n,r;r=d3.mouse(this),n=A(r),n&&(t=n.line.getClosestIndex(x.invert(n.x))),n!==!1?L(r,n,t):h()})},b.canvasId=function(e){return e==null?t:(t=e,b)},b.xScale=function(e){return e==null?x:(x=e,b)},b.yScale=function(e){return e==null?N:(N=e,b)},b.threshold=function(e){return e==null?w:(w=e,b)},b},n.brush=function(){var e,t,n,r,i,s,a,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,D,P,H,B=this;return a=this,E=Math.floor(a.h()*o.h),M=Math.floor(a.w()-c),d=p=y=g=S=null,m=v=k=A=null,i=h=s=n=null,b=x=[],P=d3.time.scale(),H=d3.scale.linear(),D=d3.svg.axis().orient("bottom").scale(P),L=10,w=10,C=6,N=100,e=0,r=document.createElement("canvas"),O=!1,T={},t=function(t){var n,b,N,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y;return s==null&&(s="canvas-brush-"+ ++u),x=t.datum(),S=_.first(x),d=_.first(S.dates()),p=_.last(S.dates()),t.attr("style","position: absolute; top: "+a.h()*(f.h+l.h)+"px; left: "+c+"px"),i=t.append("canvas"),i.attr("id",s),i.attr("style","position: absolute; left: 0px; top: 0px"),h=i.node().getContext("2d"),Y=t.append("svg"),Y.attr("class","x axis"),Y.attr("id","x-axis-"+s),Y.attr("height",Math.floor(a.h()*l.h)),Y.attr("width",Math.floor(a.w()-c)),Y.attr("style","position: absolute; top: "+a.h()*o.h+"px; left: 0px"),n=function(){return S.length()<=C?(d=_.first(S.dates()),p=_.last(S.dates()),y=P(d),g=P(p),v=!1):v=!0},Q=function(){H.domain(a.utility().getExtent(x,null,null)),H.range([E-a.padding(),a.padding()]),P.range([a.padding(),M-a.padding()]),P.domain([_.first(S.dates()),_.last(S.dates())])},J=function(){d=S.dateAt(Math.floor(a.startPoint()*S.length())),p=_.last(S.dates()),y=P(d),g=P(p),K("dateStart",d),K("dateEnd",p),K("drawStart",y),K("drawEnd",g)},G=function(){b(),O?I():B(),F()},b=function(){h.clearRect(0,0,q("width"),q("height")),i.attr("width",M).attr("height",E)},j=function(){var e;Y.selectAll("*").remove(),e=Y.append("g"),e.call(D)},B=function(){var e,t,n;for(e=t=0,n=x.length;t<n;e=++t)S=x[e],S.drawPath(h,P,H,1);S.length()<=L&&S.drawPoints(h,P,H,_.first(S.dates(),_.last(S.dates()),3)),X()},I=function(){h.drawImage(r.canvas,0,0)},X=function(){O=!0,r.setAttribute("width",M),r.setAttribute("height",E),r=r.getContext("2d"),r.drawImage(document.getElementById(s),0,0)},F=function(){h.strokeStyle="rgba(237, 237, 237, 0.80)",h.beginPath(),h.fillStyle="rgba(237, 237, 237, 0.80)",h.fillRect(y,0,g-y,E),h.closePath(),h.beginPath(),h.fillStyle="#D9D9D9",h.fillRect(y-w,0,w,E),h.closePath(),h.beginPath(),h.fillStyle="#D9D9D9",h.fillRect(g,0,w,E),h.closePath()},W=function(){r=document.createElement("canvas"),O=!1},N=function(e){var t;e=e!=null?e:!1,e&&(d=P.invert(y),p=P.invert(g),d>p&&(t=p,p=d,d=t)),a.adjust(d,S.getClosestIndex(d),p,S.getClosestIndex(p))},V=function(){var t;m=!1,k=!1,e=0,y>g&&(t=g,g=y,y=t),d=P.invert(y),p=P.invert(g),K("drawStart",y),K("dateStart",d),K("drawEnd",g),K("dateEnd",p)},R=function(e){return e<=g&&e>=y},U=function(e){return e>=y-w&&e<y},z=function(e){return e>g&&e<=g+w},$=function(e){document.getElementById(""+a.dombrush().substring(1)).className=e},K=function(e,t){T[e]=t},q=function(e){var t;return(t=T[e])!=null?t:null},K("width",M),K("height",E),Q(),n(),v&&J(),j(),N(),setInterval(G,70),a.on("respond.brush",function(){K("height",E),K("width",M),E=Math.floor(a.h()*o.h),M=Math.floor(a.w()-c),W(),Q(),y=P(d),g=P(p),V(),Y.attr("width",M),j()}),a.on("refresh.brush",function(){x=t.datum(),S=_.first(x),W(),Q(),n(),v&&J(),j(),N()}),a.on("toggle.brush",function(){W(),Q()}),i.on("mousedown",function(t){var n;d3.event.preventDefault(),n=d3.mouse(this),A=n[0],U(n[0])?(k=!0,e=-1):z(n[0])?(k=!0,e=1):R(n[0])&&(m=!0)}),i.on("mouseup",function(e){a.resetState(),N(!0),V()}),i.on("mouseout",function(e){N(!0),$(""),V()}),i.on("mousemove",function(t){var n,r;r=d3.mouse(this);if(m||k){n=r[0]-A;if(m&&v)y=q("drawStart")+n,g=q("drawEnd")+n;else if(k){if(e!==0&&e!==-1&&e!==1)throw"Error: Unknown stretching direction";e===-1&&(y=q("drawStart")+n),e===1&&(g=q("drawEnd")+n)}y=y<0?0:y,g=g>M?M:g}else v&&(R(r[0])?$("move"):U(r[0])||z(r[0])?$("resize"):$(""))})},t.canvasId=function(e){return e==null?s:(s=e,t)},t.xScale=function(e){return e==null?P:(P=e,t)},t.yScale=function(e){return e==null?H:(H=e,t)},t.threshold=function(e){return e==null?L:(L=e,t)},t.stretchLimit=function(e){return e==null?C:(C=e,t)},t.handleWidth=function(e){return e==null?w:(w=e,t)},t},n.xaxis=function(){var e,t,n,r,i,s,o,u,a,f,c,h=this;return n=this,f=n.w()*l.w,i=n.h()*l.h,a=d3.time.scale().range([0,f]),t=d3.svg.axis().scale(a),r=[],e=!1,o=[],s=null,u=null,c=function(h){var p,d;s=h.attr("id"),o=h.datum(),t.tickSize(5,3,0),d=function(){var e;return c.remove(),e=h.append("svg"),e.attr("width",f),e.attr("height",i),e.append("g"),e.attr("transform","translate(0, 27)"),e.call(t)},p=function(){return r=[o[0].dateAt(0),o[0].dateAt(o[0].length()-1)],u=n.utility().parseDate(o[0].dateAt(0)),a.domain([u(r[0]),u(r[1])]),t.tickFormat(d3.time.format("%b %d, %Y")),t.ticks(Math.floor(f/150,0,0)),a.range([0,f])},p(),d(),n.on("respond.xaxis-"+s,function(){return f=n.w()*l.w,t.ticks(Math.floor(f/150,0,0)),a.range([0,f]),d()}),n.on("refresh.xaxis-"+s,function(){return o=h.datum(),p(),d()}),e&&n.on("adjust.xaxis-"+s,function(e,t){return t=t>o[0].length()-1?o[0].length()-1:t,e=e<0?0:e,r=[o[0].dateAt(e),o[0].dateAt(t)],a.domain([u(r[0]),u(r[1])]),d()})},c.remove=function(){return d3.select("#"+s).selectAll("svg").remove()},c.active=function(t){return t?(e=t,c):e},d3.rebind(c,t,"orient","ticks","ticksSubdivide","tickSize","tickPadding","tickFormat")},n.yaxis=function(){var e,t,n,r,i,s,o,u,a,f,l,c=this;return t=this,u=t.w()*quandlism_yaxis.w,r=t.h()*quandlism_yaxis.h,o=d3.scale.linear().range([r,0]),e=d3.svg.axis().scale(o),s=[],n=[],f=null,a=null,i=null,l=function(c){var h,p;i=c.attr("id"),s=c.datum(),e.ticks(Math.floor(r/25,0,0)),e.tickSize(5,3,0),p=function(){var i,h;return n=t.utility().getExtent(s,f,a),o.domain([n[0],n[1]]),l.remove(),h=c.append("svg"),h.attr("width",u),h.attr("height","100%"),i=h.append("g"),i.attr("transform","translate("+(u-1)+", 0)"),i.attr("width",u),i.attr("height",r),i.call(e)},h=function(){a=s[0].length()-1,f=Math.floor(s[0].length()*t.endPercent())},h(),p(),t.on("toggle.y-axis-"+i,function(){p()}),t.on("refresh.y-axis-"+i,function(){s=c.datum(),h(),p()}),t.on("respond.y-axis-"+i,function(){u=t.w()*quandlism_yaxis.w,r=t.h()*quandlism_yaxis.h,e.ticks(Math.floor(r/25,0,0)),o.range([r,0]),p()}),t.on("adjust.y-axis-"+i+"}",function(e,t){f=e>0?e:0,a=t<s[0].length()?t:s[0].length(),p()})},l.remove=function(e){d3.select("#"+i).selectAll("svg").remove()},d3.rebind(l,e,"orient","ticks","ticksSubdivide","tickSize","tickPadding","tickFormat")},n.legend=function(){var e,t,n;return e=this,n=[],t=function(t){var r;r=function(){var r=this;n=t.datum(),t.selectAll("li").remove(),t.selectAll("li").data(n).enter().append("li").attr("style",function(e){return"color: "+e.color()}).attr("class",function(e){if(!e.visible())return"off"}).append("a",":first-child").attr("href","javascript:;").attr("data-line-id",function(e){return e.id()}).text(function(e){return e.name()}),t.selectAll("a").on("click",function(t,r){var i,s,o,u;i=d3.event,s=i.target,o=parseInt(s.getAttribute("data-line-id")),i.preventDefault(),u=_.find(n,function(e){return e.id()===o}),u!=null&&(u.toggle()===!1?$(s).parent().addClass("off"):$(s).parent().removeClass("off"),e.toggle())})},r(),e.on("refresh.legend",function(){r()})},t},n.utility=function(){var e,t,n=this;return e=this,t=function(){},t.truncate=function(e,t){return e.length>t?""+e.substring(0,t)+"...":e},t.buildLines=function(n){var r,i,s;return r=n.columns.slice(1),i=_.map(r,function(e,r){return t.getLineData(n.data,r)}),s=_.map(r,function(t,n){return e.line({name:t,values:i[n]})}),s},t.processLines=function(t,n){var r,i,s,o;e.addColorsIfNecessary(n);for(r=s=0,o=n.length;s<o;r=++s)i=n[r],i.color(e.colorList()[r]),t.show!=null&&t.show.length&&i.visible(h.call(t.show,r)>=0);return n},t.getLineData=function(e,t){var n;return n=d3.time.format("%Y-%m-%d"),_.map(e,function(e){return{date:n.parse(e[0]),num:e[t+1]}})},t.mergeLines=function(e,n){var r,i,s;n=t.addNewLinesAndRefresh(n,e),n=t.removeStaleLines(n,e.columns);for(i=0,s=n.length;i<s;i++)r=n[i],r.setup();return n},t.addNewLinesAndRefresh=function(n,r){var i,s,o,u,a,f,l,c,h,p,d;d=r.columns.slice(1);for(s=l=0,h=d.length;l<h;s=++l){i=d[s],o=!1,f=t.getLineData(r.data,s);for(u=c=0,p=n.length;c<p;u=++c){a=n[u];if(a.name()===i){o=!0,n[u].values(f.reverse());break}}o||(a=e.line({name:i,values:f}),n.push(a))}return n},t.removeStaleLines=function(e,t){return _.reject(e,function(e){var n;return n=e.name(),h.call(t,n)<0})},t.getExtent=function(e,t,n){var r,i;return r=function(){var r,s,o;o=[];for(r=0,s=e.length;r<s;r++)i=e[r],o.push(i.extent(t,n));return o}(),[d3.min(r,function(e){return e[0]}),d3.max(r,function(e){return e[1]})]},t.getExtentFromDates=function(e,t,n){var r,i;return r=function(){var r,s,o;o=[];for(r=0,s=e.length;r<s;r++)i=e[r],o.push(i.extentByDate(t,n));return o}(),[d3.min(r,function(e){return e[0]}),d3.max(r,function(e){return e[1]})]},t.getMonthName=function(e){var t;return t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t[e]},t.getColor=function(t){return e.colorList()[t]},t.formatNumberAsString=function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},t.getPixelRGB=function(e,t){var n,r;return n=t.getImageData(e[0],e[1],1,1).data,r=d3.rgb(n[0],n[1],n[2]),r.toString()},t.getUnitAndDivisor=function(e){var t;return t=e.toString().length,t<=3?{label:"",divisor:1}:t<=6?{label:"K",divisor:1e3}:t<=9?{label:"M",divisor:1e6}:{label:"B",divisor:1e9}},t.getDateKey=function(e){return e==null?null:e.valueOf()},t}}).call(this)})(this);